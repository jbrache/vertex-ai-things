# PIPELINE DEFINITION
# Name: dns-peering-test-pipeline
# Description: Test DNS Peering using env variable
# Inputs:
#    dns_domain: str
#    proxy_vm_ip: str
#    proxy_vm_port: str
components:
  comp-dns-peering-test-op:
    executorLabel: exec-dns-peering-test-op
    inputDefinitions:
      parameters:
        dns_domain:
          parameterType: STRING
        proxy_vm_ip:
          parameterType: STRING
        proxy_vm_port:
          parameterType: STRING
defaultPipelineRoot: ${default_pipeline_root}
deploymentSpec:
  executors:
    exec-dns-peering-test-op:
      container:
        args:
        - "\n            # These are installed in the container\n            # apt-get\
          \ update && apt-get install inetutils-traceroute inetutils-ping netcat-openbsd\
          \ curl -y\n\n            echo \"Local IP(s): $(hostname -I)\"\n\n      \
          \      echo \"Attempting to trace route to {{$.inputs.parameters['dns_domain']}}\"\
          \n            traceroute -w 1 -m 7 \"{{$.inputs.parameters['dns_domain']}}\"\
          \n\n            echo \"Sending curl requests to http://{{$.inputs.parameters['dns_domain']}}\
          \ via proxy {{$.inputs.parameters['proxy_vm_ip']}}:{{$.inputs.parameters['proxy_vm_port']}}\
          \ and recording trace...\"\n            if curl -L -v --trace-ascii /dev/stdout\
          \ -x http://{{$.inputs.parameters['proxy_vm_ip']}}:{{$.inputs.parameters['proxy_vm_port']}}\
          \ \"http://{{$.inputs.parameters['dns_domain']}}\"; then\n             \
          \   echo \"Curl request succeeded!\"\n            else\n               \
          \ echo \"Curl request failed!\"\n                exit 1\n            fi\n\
          \            "
        command:
        - bash
        - -c
        image: ${image_uri}
pipelineInfo:
  description: Test DNS Peering using env variable
  name: dns-peering-test-pipeline
root:
  dag:
    tasks:
      dns-peering-test-op:
        cachingOptions: {}
        componentRef:
          name: comp-dns-peering-test-op
        inputs:
          parameters:
            dns_domain:
              componentInputParameter: dns_domain
            proxy_vm_ip:
              componentInputParameter: proxy_vm_ip
            proxy_vm_port:
              componentInputParameter: proxy_vm_port
        taskInfo:
          name: dns-peering-test-op
  inputDefinitions:
    parameters:
      dns_domain:
        parameterType: STRING
      proxy_vm_ip:
        parameterType: STRING
      proxy_vm_port:
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.14.6
